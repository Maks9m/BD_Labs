# Schema Migrations with Prisma ORM (Lab 6)

## 1\. Migration History

Below is a detailed log of all schema changes, including the Prisma schema definitions and the corresponding SQL commands generated by `npx prisma migrate dev`.

### Migration 1: Initialization (`0_init`)

**Description:** The basic database structure was created, mirroring the schema from Laboratory Work \#5.

**Prisma Schema:**

```prisma
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model booking {
  book_id Int     @id @default(autoincrement())
  user_id Int?
  car_id  Int?
  status  status? @default(pending)
  car     car?    @relation(fields: [car_id], references: [car_id], onUpdate: NoAction)
  user    user?   @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)
  trip    trip[]
}

model car {
  car_id        Int           @id @default(autoincrement())
  model_id      Int?
  location      Int?
  license_plate String        @unique @db.VarChar(20)
  status        car_status
  booking       booking[]
  car_location  car_location? @relation(fields: [location], references: [car_location_id], onUpdate: NoAction)
  car_model     car_model?    @relation(fields: [model_id], references: [model_id], onDelete: Restrict, onUpdate: NoAction)
}

model car_location {
  car_location_id                        Int    @id @default(autoincrement())
  address                                String @db.VarChar(255)
  car                                    car[]
  trip_trip_end_locationTocar_location   trip[] @relation("trip_end_locationTocar_location")
  trip_trip_start_locationTocar_location trip[] @relation("trip_start_locationTocar_location")
}

model car_model {
  model_id   Int     @id @default(autoincrement())
  model_name String  @unique @db.VarChar(50)
  fuel_type  fuel
  base_price Decimal @db.Decimal(8, 2)
  car        car[]
}

model driver_license {
  driver_license_id Int      @id @default(autoincrement())
  license_number    String   @unique @db.Char(10)
  license_type      license
  expiry_date       DateTime @db.Date
  user              user[]
}

model payment {
  payment_id         Int           @id @default(autoincrement())
  trip_id            Int?
  payment_date       DateTime      @db.Timestamp(6)
  amount             Decimal       @db.Decimal(8, 2)
  payment_type       payment_type?
  transaction_method transaction?
  status             status?       @default(pending)
  trip               trip?         @relation(fields: [trip_id], references: [trip_id], onUpdate: NoAction)
}

model trip {
  trip_id                                        Int           @id @default(autoincrement())
  book_id                                        Int?
  start_location                                 Int?
  end_location                                   Int?
  start_time                                     DateTime      @default(now()) @db.Timestamp(6)
  end_time                                       DateTime?     @db.Timestamp(6)
  price                                          Decimal?      @db.Decimal(8, 2)
  payment                                        payment[]
  booking                                        booking?      @relation(fields: [book_id], references: [book_id], onUpdate: NoAction)
  car_location_trip_end_locationTocar_location   car_location? @relation("trip_end_locationTocar_location", fields: [end_location], references: [car_location_id], onUpdate: NoAction)
  car_location_trip_start_locationTocar_location car_location? @relation("trip_start_locationTocar_location", fields: [start_location], references: [car_location_id], onUpdate: NoAction)
}

model user {
  user_id           Int             @id @default(autoincrement())
  driver_license_id Int?
  email             String          @unique @db.VarChar(100)
  firstname         String          @db.VarChar(32)
  lastname          String          @db.VarChar(32)
  booking           booking[]
  driver_license    driver_license? @relation(fields: [driver_license_id], references: [driver_license_id], onUpdate: NoAction)
}

enum car_status {
  Available
  Booked
  Repaired
}

enum fuel {
  Petrol
  Diesel
  Electric
  Hybrid
}

enum license {
  A
  B
  C
  D
  E
}

enum payment_type {
  Credit_Card @map("Credit Card")
  Debit_Card  @map("Debit Card")
  Gift_Card   @map("Gift Card")
}

enum status {
  pending
  confirmed
  completed
}

enum transaction {
  Online
  POS
}

```

**SQL Migration Code:**

```sql
-- CreateSchema
CREATE SCHEMA IF NOT EXISTS "public";

-- CreateEnum
CREATE TYPE "car_status" AS ENUM ('Available', 'Booked', 'Repaired');

-- CreateEnum
CREATE TYPE "fuel" AS ENUM ('Petrol', 'Diesel', 'Electric', 'Hybrid');

-- CreateEnum
CREATE TYPE "license" AS ENUM ('A', 'B', 'C', 'D', 'E');

-- CreateEnum
CREATE TYPE "payment_type" AS ENUM ('Credit Card', 'Debit Card', 'Gift Card');

-- CreateEnum
CREATE TYPE "status" AS ENUM ('pending', 'confirmed', 'completed');

-- CreateEnum
CREATE TYPE "transaction" AS ENUM ('Online', 'POS');

-- CreateTable
CREATE TABLE "booking" (
    "book_id" SERIAL NOT NULL,
    "user_id" INTEGER,
    "car_id" INTEGER,
    "status" "status" DEFAULT 'pending',

    CONSTRAINT "booking_pkey" PRIMARY KEY ("book_id")
);

-- CreateTable
CREATE TABLE "car" (
    "car_id" SERIAL NOT NULL,
    "model_id" INTEGER,
    "location" INTEGER,
    "license_plate" VARCHAR(20) NOT NULL,
    "status" "car_status" NOT NULL,

    CONSTRAINT "car_pkey" PRIMARY KEY ("car_id")
);

-- CreateTable
CREATE TABLE "car_location" (
    "car_location_id" SERIAL NOT NULL,
    "address" VARCHAR(255) NOT NULL,

    CONSTRAINT "car_location_pkey" PRIMARY KEY ("car_location_id")
);

-- CreateTable
CREATE TABLE "car_model" (
    "model_id" SERIAL NOT NULL,
    "model_name" VARCHAR(50) NOT NULL,
    "fuel_type" "fuel" NOT NULL,
    "base_price" DECIMAL(8,2) NOT NULL,

    CONSTRAINT "car_model_pkey" PRIMARY KEY ("model_id")
);

-- CreateTable
CREATE TABLE "driver_license" (
    "driver_license_id" SERIAL NOT NULL,
    "license_number" CHAR(10) NOT NULL,
    "license_type" "license" NOT NULL,
    "expiry_date" DATE NOT NULL,

    CONSTRAINT "driver_license_pkey" PRIMARY KEY ("driver_license_id")
);

-- CreateTable
CREATE TABLE "payment" (
    "payment_id" SERIAL NOT NULL,
    "trip_id" INTEGER,
    "payment_date" TIMESTAMP(6) NOT NULL,
    "amount" DECIMAL(8,2) NOT NULL,
    "payment_type" "payment_type",
    "transaction_method" "transaction",
    "status" "status" DEFAULT 'pending',

    CONSTRAINT "payment_pkey" PRIMARY KEY ("payment_id")
);

-- CreateTable
CREATE TABLE "trip" (
    "trip_id" SERIAL NOT NULL,
    "book_id" INTEGER,
    "start_location" INTEGER,
    "end_location" INTEGER,
    "start_time" TIMESTAMP(6) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "end_time" TIMESTAMP(6),
    "price" DECIMAL(8,2),

    CONSTRAINT "trip_pkey" PRIMARY KEY ("trip_id")
);

-- CreateTable
CREATE TABLE "user" (
    "user_id" SERIAL NOT NULL,
    "driver_license_id" INTEGER,
    "email" VARCHAR(100) NOT NULL,
    "firstname" VARCHAR(32) NOT NULL,
    "lastname" VARCHAR(32) NOT NULL,

    CONSTRAINT "user_pkey" PRIMARY KEY ("user_id")
);

-- CreateIndex
CREATE UNIQUE INDEX "car_license_plate_key" ON "car"("license_plate");

-- CreateIndex
CREATE UNIQUE INDEX "car_model_model_name_key" ON "car_model"("model_name");

-- CreateIndex
CREATE UNIQUE INDEX "driver_license_license_number_key" ON "driver_license"("license_number");

-- CreateIndex
CREATE UNIQUE INDEX "user_email_key" ON "user"("email");

-- AddForeignKey
ALTER TABLE "booking" ADD CONSTRAINT "booking_car_id_fkey" FOREIGN KEY ("car_id") REFERENCES "car"("car_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "booking" ADD CONSTRAINT "booking_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "user"("user_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "car" ADD CONSTRAINT "car_location_fkey" FOREIGN KEY ("location") REFERENCES "car_location"("car_location_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "car" ADD CONSTRAINT "car_model_id_fkey" FOREIGN KEY ("model_id") REFERENCES "car_model"("model_id") ON DELETE RESTRICT ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "payment" ADD CONSTRAINT "payment_trip_id_fkey" FOREIGN KEY ("trip_id") REFERENCES "trip"("trip_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "trip" ADD CONSTRAINT "trip_book_id_fkey" FOREIGN KEY ("book_id") REFERENCES "booking"("book_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "trip" ADD CONSTRAINT "trip_end_location_fkey" FOREIGN KEY ("end_location") REFERENCES "car_location"("car_location_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "trip" ADD CONSTRAINT "trip_start_location_fkey" FOREIGN KEY ("start_location") REFERENCES "car_location"("car_location_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "user" ADD CONSTRAINT "user_driver_license_id_fkey" FOREIGN KEY ("driver_license_id") REFERENCES "driver_license"("driver_license_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- These constraints are not natively supported by Prisma Schema yet.
-- Add these to your migration.sql file to enforce them in the database.

ALTER TABLE "car_model" ADD CONSTRAINT "car_model_base_price_check" CHECK (base_price > 0);
ALTER TABLE "payment" ADD CONSTRAINT "payment_amount_check" CHECK (amount > 0);
ALTER TABLE "trip" ADD CONSTRAINT "trip_price_check" CHECK (price >= 0);
```

-----

### Migration 2: Adding Comments (`add-comment-table`)

**Description:** A new `Comment` model was added to implement a Many-to-Many relationship between Users and Trips.

**Prisma Schema (Added/Modified Models):**

```prisma
model comment {
  comment_id Int     @id @default(autoincrement())
  user_id    Int?
  trip_id    Int?
  content    String  @db.VarChar(500)
  user       user?   @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)
  trip       trip?   @relation(fields: [trip_id], references: [trip_id], onUpdate: NoAction)
}

model user {
  // ... existing fields
  comments comment[] // Relation added
}

model trip {
  // ... existing fields
  comments comment[] // Relation added
}
```

**SQL Migration Code:**

```sql
-- CreateTable
CREATE TABLE "comment" (
    "comment_id" SERIAL NOT NULL,
    "user_id" INTEGER,
    "trip_id" INTEGER,
    "content" VARCHAR(500) NOT NULL,

    CONSTRAINT "comment_pkey" PRIMARY KEY ("comment_id")
);

-- AddForeignKey
ALTER TABLE "comment" ADD CONSTRAINT "comment_user_id_fkey" FOREIGN KEY ("user_id") REFERENCES "user"("user_id") ON DELETE SET NULL ON UPDATE NO ACTION;

-- AddForeignKey
ALTER TABLE "comment" ADD CONSTRAINT "comment_trip_id_fkey" FOREIGN KEY ("trip_id") REFERENCES "trip"("trip_id") ON DELETE SET NULL ON UPDATE NO ACTION;
```

-----

### Migration 3: Renaming Field (`rename-comment-field`)

**Description:** In the `Comment` model, the `content` field was renamed to `text`.

**Prisma Schema (Modified `Comment`):**

```prisma
model comment {
  comment_id Int     @id @default(autoincrement())
  user_id    Int?
  trip_id    Int?
  text    String  @db.VarChar(500)
  user       user?   @relation(fields: [user_id], references: [user_id], onUpdate: NoAction)
  trip       trip?   @relation(fields: [trip_id], references: [trip_id], onUpdate: NoAction)
}
```

**SQL Migration Code:**

```sql
/*
  Warnings:

  - You are about to drop the column `content` on the `comment` table. All the data in the column will be lost.
  - Added the required column `text` to the `comment` table without a default value. This is not possible if the table is not empty.

*/
-- AlterTable
ALTER TABLE "comment" DROP COLUMN "content",
ADD COLUMN     "text" VARCHAR(500) NOT NULL;
```

-----

### Migration 4: Removing Column (`change-licence-enum-values`)

**Description:** The `updated_at` field was removed from the `Quiz` model.

**Prisma Schema (Modified `Quiz`):**

```prisma
enum license {
  M
  A
  A1
  B1
  BE
  B
  C1
  D1
}
```

**SQL Migration Code:**

```sql
/*
  Warnings:

  - The values [C,D,E] on the enum `license` will be removed. If these variants are still used in the database, this will fail.

*/
-- AlterEnum
BEGIN;
CREATE TYPE "license_new" AS ENUM ('M', 'A', 'A1', 'B1', 'BE', 'B', 'C1', 'D1');
ALTER TABLE "driver_license" ALTER COLUMN "license_type" TYPE "license_new" USING ("license_type"::text::"license_new");
ALTER TYPE "license" RENAME TO "license_old";
ALTER TYPE "license_new" RENAME TO "license";
DROP TYPE "public"."license_old";
COMMIT;
```

## 3\. Data Verification

### 3.1. Database Seeding

The `seed.ts` script was used to clear and repopulate the database.

**Seed Script Code (`prisma/seed.ts`):**

```typescript
import { PrismaClient, Prisma, license, car_status, fuel, payment_type, transaction, status } from '@prisma/client';

const prisma = new PrismaClient();

async function main() {
  console.log('Clean existing tables...');
  // We delete child tables first.
  await prisma.payment.deleteMany();
  await prisma.trip.deleteMany();
  await prisma.booking.deleteMany();
  await prisma.car.deleteMany();
  await prisma.user.deleteMany();
  await prisma.driver_license.deleteMany();
  await prisma.car_model.deleteMany();
  await prisma.car_location.deleteMany();

  console.log('Seeding data...');

  
  await prisma.driver_license.createMany({
    data: [
      { driver_license_id: 1, license_number: 'DL10000001', license_type: license.B, expiry_date: new Date('2026-01-15') },
      { driver_license_id: 2, license_number: 'DL10000002', license_type: license.B, expiry_date: new Date('2027-03-22') },
      { driver_license_id: 3, license_number: 'DL10000003', license_type: license.A1, expiry_date: new Date('2025-11-30') },
      { driver_license_id: 4, license_number: 'DL10000004', license_type: license.C1, expiry_date: new Date('2028-07-10') },
      { driver_license_id: 5, license_number: 'DL10000005', license_type: license.B, expiry_date: new Date('2026-09-05') },
      { driver_license_id: 6, license_number: 'DL10000006', license_type: license.B, expiry_date: new Date('2029-02-14') },
      { driver_license_id: 7, license_number: 'DL10000007', license_type: license.D1, expiry_date: new Date('2025-12-25') },
      { driver_license_id: 8, license_number: 'DL10000008', license_type: license.B, expiry_date: new Date('2027-06-18') },
      { driver_license_id: 9, license_number: 'DL10000009', license_type: license.BE, expiry_date: new Date('2030-01-01') },
      { driver_license_id: 10, license_number: 'DL10000010', license_type: license.B, expiry_date: new Date('2026-04-12') },
      { driver_license_id: 11, license_number: 'DL10000011', license_type: license.A1, expiry_date: new Date('2028-08-30') },
      { driver_license_id: 12, license_number: 'DL10000012', license_type: license.B, expiry_date: new Date('2027-10-05') },
    ],
  });

  // 2. Users
  await prisma.user.createMany({
    data: [
      { user_id: 1, email: 'john.doe@example.com', firstname: 'John', lastname: 'Doe', driver_license_id: 1 },
      { user_id: 2, email: 'jane.smith@example.com', firstname: 'Jane', lastname: 'Smith', driver_license_id: 2 },
      { user_id: 3, email: 'mike.jones@example.com', firstname: 'Mike', lastname: 'Jones', driver_license_id: 3 },
      { user_id: 4, email: 'sarah.connor@example.com', firstname: 'Sarah', lastname: 'Connor', driver_license_id: 4 },
      { user_id: 5, email: 'bruce.wayne@example.com', firstname: 'Bruce', lastname: 'Wayne', driver_license_id: 5 },
      { user_id: 6, email: 'clark.kent@example.com', firstname: 'Clark', lastname: 'Kent', driver_license_id: 6 },
      { user_id: 7, email: 'diana.prince@example.com', firstname: 'Diana', lastname: 'Prince', driver_license_id: 7 },
      { user_id: 8, email: 'peter.parker@example.com', firstname: 'Peter', lastname: 'Parker', driver_license_id: 8 },
      { user_id: 9, email: 'tony.stark@example.com', firstname: 'Tony', lastname: 'Stark', driver_license_id: 9 },
      { user_id: 10, email: 'natasha.romanoff@example.com', firstname: 'Natasha', lastname: 'Romanoff', driver_license_id: 10 },
      { user_id: 11, email: 'steve.rogers@example.com', firstname: 'Steve', lastname: 'Rogers', driver_license_id: 11 },
      { user_id: 12, email: 'wanda.maximoff@example.com', firstname: 'Wanda', lastname: 'Maximoff', driver_license_id: 12 },
    ],
  });

  // 3. Car Locations
  await prisma.car_location.createMany({
    data: [
      { car_location_id: 1, address: '123 Main St, New York, NY' },
      { car_location_id: 2, address: '456 Elm St, Los Angeles, CA' },
      { car_location_id: 3, address: '789 Oak St, Chicago, IL' },
      { car_location_id: 4, address: '101 Pine St, Houston, TX' },
      { car_location_id: 5, address: '202 Maple St, Phoenix, AZ' },
      { car_location_id: 6, address: '303 Cedar St, Philadelphia, PA' },
      { car_location_id: 7, address: '404 Birch St, San Antonio, TX' },
      { car_location_id: 8, address: '505 Walnut St, San Diego, CA' },
      { car_location_id: 9, address: '606 Ash St, Dallas, TX' },
      { car_location_id: 10, address: '707 Cherry St, San Jose, CA' },
      { car_location_id: 11, address: '808 Spruce St, Austin, TX' },
      { car_location_id: 12, address: '909 Fir St, Jacksonville, FL' },
    ],
  });

  // 4. Car Models
  await prisma.car_model.createMany({
    data: [
      { model_id: 1, model_name: 'Toyota Corolla', fuel_type: fuel.Petrol, base_price: new Prisma.Decimal(50.00) },
      { model_id: 2, model_name: 'Honda Civic', fuel_type: fuel.Petrol, base_price: new Prisma.Decimal(55.00) },
      { model_id: 3, model_name: 'Tesla Model 3', fuel_type: fuel.Electric, base_price: new Prisma.Decimal(80.00) },
      { model_id: 4, model_name: 'Ford Mustang', fuel_type: fuel.Petrol, base_price: new Prisma.Decimal(90.00) },
      { model_id: 5, model_name: 'Chevrolet Bolt', fuel_type: fuel.Electric, base_price: new Prisma.Decimal(70.00) },
      { model_id: 6, model_name: 'Toyota Prius', fuel_type: fuel.Hybrid, base_price: new Prisma.Decimal(60.00) },
      { model_id: 7, model_name: 'BMW 3 Series', fuel_type: fuel.Diesel, base_price: new Prisma.Decimal(85.00) },
      { model_id: 8, model_name: 'Audi A4', fuel_type: fuel.Diesel, base_price: new Prisma.Decimal(88.00) },
      { model_id: 9, model_name: 'Nissan Leaf', fuel_type: fuel.Electric, base_price: new Prisma.Decimal(65.00) },
      { model_id: 10, model_name: 'Hyundai Elantra', fuel_type: fuel.Hybrid, base_price: new Prisma.Decimal(52.00) },
      { model_id: 11, model_name: 'Kia Forte', fuel_type: fuel.Petrol, base_price: new Prisma.Decimal(48.00) },
      { model_id: 12, model_name: 'Mercedes C-Class', fuel_type: fuel.Diesel, base_price: new Prisma.Decimal(95.00) },
    ],
  });

  // 5. Cars
  await prisma.car.createMany({
    data: [
      { car_id: 1, model_id: 1, location: 1, license_plate: 'ABC-1234', status: car_status.Available },
      { car_id: 2, model_id: 2, location: 2, license_plate: 'DEF-5678', status: car_status.Booked },
      { car_id: 3, model_id: 3, location: 3, license_plate: 'GHI-9012', status: car_status.Available },
      { car_id: 4, model_id: 4, location: 4, license_plate: 'JKL-3456', status: car_status.Repaired },
      { car_id: 5, model_id: 5, location: 5, license_plate: 'MNO-7890', status: car_status.Available },
      { car_id: 6, model_id: 6, location: 6, license_plate: 'PQR-1234', status: car_status.Booked },
      { car_id: 7, model_id: 7, location: 7, license_plate: 'STU-5678', status: car_status.Available },
      { car_id: 8, model_id: 8, location: 8, license_plate: 'VWX-9012', status: car_status.Available },
      { car_id: 9, model_id: 9, location: 9, license_plate: 'YZA-3456', status: car_status.Booked },
      { car_id: 10, model_id: 10, location: 10, license_plate: 'BCD-7890', status: car_status.Available },
      { car_id: 11, model_id: 11, location: 11, license_plate: 'EFG-1234', status: car_status.Repaired },
      { car_id: 12, model_id: 12, location: 12, license_plate: 'HIJ-5678', status: car_status.Available },
    ],
  });

  // 6. Bookings
  await prisma.booking.createMany({
    data: [
      { book_id: 1, user_id: 1, car_id: 1, status: status.completed },
      { book_id: 2, user_id: 2, car_id: 2, status: status.confirmed },
      { book_id: 3, user_id: 3, car_id: 3, status: status.completed },
      { book_id: 4, user_id: 4, car_id: 4, status: status.pending },
      { book_id: 5, user_id: 5, car_id: 5, status: status.completed },
      { book_id: 6, user_id: 6, car_id: 6, status: status.confirmed },
      { book_id: 7, user_id: 7, car_id: 7, status: status.completed },
      { book_id: 8, user_id: 8, car_id: 8, status: status.completed },
      { book_id: 9, user_id: 9, car_id: 9, status: status.confirmed },
      { book_id: 10, user_id: 10, car_id: 10, status: status.completed },
      { book_id: 11, user_id: 11, car_id: 11, status: status.pending },
      { book_id: 12, user_id: 12, car_id: 12, status: status.completed },
      { book_id: 13, user_id: 1, car_id: 3, status: status.completed },
      { book_id: 14, user_id: 2, car_id: 4, status: status.completed },
      { book_id: 15, user_id: 3, car_id: 5, status: status.completed },
    ],
  });

  // 7. Trips
  await prisma.trip.createMany({
    data: [
      { trip_id: 1, book_id: 1, start_location: 1, end_location: 2, start_time: new Date('2025-11-01T10:00:00'), end_time: new Date('2025-11-01T12:00:00'), price: new Prisma.Decimal(100.00) },
      { trip_id: 2, book_id: 3, start_location: 3, end_location: 4, start_time: new Date('2025-11-02T14:00:00'), end_time: new Date('2025-11-02T16:00:00'), price: new Prisma.Decimal(160.00) },
      { trip_id: 3, book_id: 5, start_location: 5, end_location: 6, start_time: new Date('2025-11-03T09:00:00'), end_time: new Date('2025-11-03T11:00:00'), price: new Prisma.Decimal(140.00) },
      { trip_id: 4, book_id: 7, start_location: 7, end_location: 8, start_time: new Date('2025-11-04T13:00:00'), end_time: new Date('2025-11-04T15:00:00'), price: new Prisma.Decimal(170.00) },
      { trip_id: 5, book_id: 8, start_location: 8, end_location: 9, start_time: new Date('2025-11-05T08:00:00'), end_time: new Date('2025-11-05T10:00:00'), price: new Prisma.Decimal(176.00) },
      { trip_id: 6, book_id: 10, start_location: 10, end_location: 11, start_time: new Date('2025-11-06T15:00:00'), end_time: new Date('2025-11-06T17:00:00'), price: new Prisma.Decimal(104.00) },
      { trip_id: 7, book_id: 12, start_location: 12, end_location: 1, start_time: new Date('2025-11-07T11:00:00'), end_time: new Date('2025-11-07T13:00:00'), price: new Prisma.Decimal(190.00) },
      { trip_id: 8, book_id: 2, start_location: 2, end_location: 3, start_time: new Date('2025-11-08T10:00:00'), end_time: null, price: new Prisma.Decimal(110.00) },
      { trip_id: 9, book_id: 6, start_location: 6, end_location: 7, start_time: new Date('2025-11-09T12:00:00'), end_time: null, price: new Prisma.Decimal(120.00) },
      { trip_id: 10, book_id: 9, start_location: 9, end_location: 10, start_time: new Date('2025-11-10T14:00:00'), end_time: null, price: new Prisma.Decimal(130.00) },
      { trip_id: 11, book_id: 13, start_location: 3, end_location: 1, start_time: new Date('2025-11-12T08:00:00'), end_time: new Date('2025-11-12T09:00:00'), price: new Prisma.Decimal(80.00) },
      { trip_id: 12, book_id: 14, start_location: 4, end_location: 2, start_time: new Date('2025-11-13T10:00:00'), end_time: new Date('2025-11-13T11:00:00'), price: new Prisma.Decimal(90.00) },
    ],
  });

  // 8. Payments
  await prisma.payment.createMany({
    data: [
      { payment_id: 1, trip_id: 1, payment_date: new Date('2025-11-01T12:05:00'), amount: new Prisma.Decimal(100.00), payment_type: payment_type.Credit_Card, transaction_method: transaction.Online, status: status.completed },
      { payment_id: 2, trip_id: 2, payment_date: new Date('2025-11-02T16:05:00'), amount: new Prisma.Decimal(160.00), payment_type: payment_type.Debit_Card, transaction_method: transaction.POS, status: status.completed },
      { payment_id: 3, trip_id: 3, payment_date: new Date('2025-11-03T11:05:00'), amount: new Prisma.Decimal(140.00), payment_type: payment_type.Credit_Card, transaction_method: transaction.Online, status: status.completed },
      { payment_id: 4, trip_id: 4, payment_date: new Date('2025-11-04T15:05:00'), amount: new Prisma.Decimal(170.00), payment_type: payment_type.Gift_Card, transaction_method: transaction.Online, status: status.completed },
      { payment_id: 5, trip_id: 5, payment_date: new Date('2025-11-05T10:05:00'), amount: new Prisma.Decimal(176.00), payment_type: payment_type.Debit_Card, transaction_method: transaction.POS, status: status.completed },
      { payment_id: 6, trip_id: 6, payment_date: new Date('2025-11-06T17:05:00'), amount: new Prisma.Decimal(104.00), payment_type: payment_type.Credit_Card, transaction_method: transaction.Online, status: status.completed },
      { payment_id: 7, trip_id: 7, payment_date: new Date('2025-11-07T13:05:00'), amount: new Prisma.Decimal(190.00), payment_type: payment_type.Credit_Card, transaction_method: transaction.POS, status: status.completed },
      { payment_id: 8, trip_id: 8, payment_date: new Date('2025-11-08T10:05:00'), amount: new Prisma.Decimal(110.00), payment_type: payment_type.Debit_Card, transaction_method: transaction.Online, status: status.pending },
      { payment_id: 9, trip_id: 9, payment_date: new Date('2025-11-09T12:05:00'), amount: new Prisma.Decimal(120.00), payment_type: payment_type.Credit_Card, transaction_method: transaction.Online, status: status.pending },
      { payment_id: 10, trip_id: 10, payment_date: new Date('2025-11-10T14:05:00'), amount: new Prisma.Decimal(130.00), payment_type: payment_type.Gift_Card, transaction_method: transaction.POS, status: status.pending },
      { payment_id: 11, trip_id: 11, payment_date: new Date('2025-11-12T09:05:00'), amount: new Prisma.Decimal(80.00), payment_type: payment_type.Credit_Card, transaction_method: transaction.Online, status: status.completed },
      { payment_id: 12, trip_id: 12, payment_date: new Date('2025-11-13T11:05:00'), amount: new Prisma.Decimal(90.00), payment_type: payment_type.Debit_Card, transaction_method: transaction.POS, status: status.completed },
    ],
  });

  // Reset sequences
  const tables = [
    { name: 'driver_license', pk: 'driver_license_id' },
    { name: 'user', pk: 'user_id' },
    { name: 'car_location', pk: 'car_location_id' },
    { name: 'car_model', pk: 'model_id' },
    { name: 'car', pk: 'car_id' },
    { name: 'booking', pk: 'book_id' },
    { name: 'trip', pk: 'trip_id' },
    { name: 'payment', pk: 'payment_id' },
  ];

  for (const table of tables) {
    await prisma.$executeRawUnsafe(
      `SELECT setval(pg_get_serial_sequence('"${table.name}"', '${table.pk}'), coalesce(max("${table.pk}")+1, 1), false) FROM "${table.name}";`
    );
  }

  console.log('Seeding finished.');
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
  });
```

## 4\. Conclusion

In this laboratory work, Prisma ORM was successfully configured. Four stages of schema migration were implemented and documented with both Prisma schema definitions and generated SQL code. Data integrity was verified through seeding and test queries.

## 5\. Database view

<img width="1594" height="222" alt="image" src="https://github.com/user-attachments/assets/75037158-b83d-469c-b381-fa45cbbfab19" />

<img width="704" height="463" alt="image" src="https://github.com/user-attachments/assets/9d5879c5-4b80-4ab7-bf7f-e7617ac2452b" />

<img width="841" height="394" alt="image" src="https://github.com/user-attachments/assets/44ee258c-fae1-4462-a04f-28f5e0cb2ae3" />

<img width="467" height="377" alt="image" src="https://github.com/user-attachments/assets/d4b55a71-769d-424a-abf2-43b582375c44" />

<img width="698" height="380" alt="image" src="https://github.com/user-attachments/assets/fb776b9b-6485-424f-a215-f254a297cb10" />

<img width="715" height="379" alt="image" src="https://github.com/user-attachments/assets/1b2dac72-273b-465c-81c1-4555c00c05ed" />

<img width="1159" height="390" alt="image" src="https://github.com/user-attachments/assets/7ddcc23b-797b-433a-b687-9bc0eb0ebbb3" />

<img width="1108" height="399" alt="image" src="https://github.com/user-attachments/assets/f07f9080-e689-4a2e-bd24-62168dd5910e" />

<img width="876" height="402" alt="image" src="https://github.com/user-attachments/assets/bc19bacd-8f30-4e44-80e9-fdb6dedc705e" />

<img width="1350" height="98" alt="image" src="https://github.com/user-attachments/assets/5b354de4-64ea-4190-940c-af95ee0f8b2d" />

<img width="719" height="118" alt="image" src="https://github.com/user-attachments/assets/c15e1574-3e29-46e6-8fce-5d71746f13e6" />
